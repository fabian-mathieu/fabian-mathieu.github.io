<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Dataviz - les groupes musicaux en france">
  <meta name="author" content="Fabian MATHIEU">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="max-age=31536000, must-revalidate">
  <title>Dataviz</title>
  <link rel="icon" type="image/x-icon" href="img/icon.png">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" >
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"> </script>

</head>
<body>
  <header>
    <div class="pnr"><a href="index.html"><img class="logo" src="img/logo.svg" width="64" height="105"></a>
      <h1><a href="index.html">Dataviz : la répartition des groupes musicaux en France</a></h1>
    </div>
    <nav class="nav">
      <ul class="ul">
        <li class="active"><a href="index.html"><img src="img/geo_white.svg" width="16" height="16">Carte</a></li>
		<li><a href="infographie.html"><img src="img/graph_blue.svg" width="16" height="16">Infographie</a></li>
		<li><a href="dataviz.html"><img src="img/chart_blue.svg" width="16" height="16">Dataviz</a></li>
        <li><a href="a_propos.html"><img src="img/info_blue.svg" width="16" height="16">À propos</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <h1> Visualisation des groupes musicaux actifs listés sur MusicBrainz.org </h1>
	<div id="mymap"></div>
	  <script>
	    // fond de carte
	    var mymap = L.map('mymap', {center: [47.1359, 2.12495], zoom: 6});
	    var baselayers = {
	    fond_osm: L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png',{attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}),
	    fond_carto: L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{attribution: '<a href="https://carto.com/basemaps">cartocdn</a>'}).addTo(mymap)};
	    baselayers.fond_carto.addTo(mymap);
	    L.control.scale().addTo(mymap);
	    L.control.layers(baselayers, null, {position:'topright'}, {collapsed: false}).addTo(mymap);

        // ajout données carte
	    fetch('data_leaflet/villes_avec_groupes.geojson')
       .then(response => response.json())
       .then(data => {
        L.geoJson(data, {
        style: style,
        onEachFeature: onEachFeature
        }).addTo(mymap);
        })
       .catch(error => console.error('Erreur lors du chargement du GeoJSON:', error));

       function style(feature) {
         const nbGroupes = feature.properties.groupes ? feature.properties.groupes.length : 0;
         return {
           weight: 0.5,
           opacity: 1,
           color: 'white',
           dashArray: '3',
           fillOpacity: 0.5,
           fillColor: #448aff
           };
        }
	   
	   // panneau de statistiques
       var info = L.control();
       info.onAdd = function (map) {
         this._div = L.DomUtil.create('div', 'info');
         this.update();
         return this._div;
        };
            
      info.update = function (props) {
        this._div.innerHTML = '<h4>Statistiques locales</h4>' +  (props ? 
        `<b>Commune :</b> ${props.NOM}<br>
        <b>Population :</b> ${props.POPULATION} habitants<br>
        <b>Groupes :</b> ${props.groupes.length}` : 'Survolez une commune');
      };
	  
      info.addTo(mymap);
	
      function highlightFeature(e) {
        var layer = e.target;     
        layer.setStyle({
            weight: 3,
            color: '#111',
            dashArray: '',
            fillOpacity: 0.7
        });
        if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
            layer.bringToFront();
        } 
        info.update(layer.feature.properties);
      }

        function resetHighlight(e) {
          info.update();
        }
        function onEachFeature(feature, layer) {
          layer.on({
            mousein: highlightFeature,
            mouseout: resetHighlight
          });
        }
		
		
    </script>
  </main>
</body>
</html>